# æ‰“åŒ…å‰æ£€æŸ¥æ¸…å•

## âš ï¸ é‡è¦æé†’

æ¯æ¬¡ä¿®æ”¹ `.spec` æ–‡ä»¶åï¼Œ**å¿…é¡»**è¿è¡Œè¿™äº›æ£€æŸ¥ä»¥é¿å…æ¨¡å—ç¼ºå¤±ï¼

---

## ğŸ” å¿…é¡»æ£€æŸ¥çš„æ¨¡å—

### 1. email ç›¸å…³æ¨¡å—ï¼ˆrequests ä¾èµ–ï¼‰

**ä¸èƒ½æ’é™¤çš„æ¨¡å—**ï¼š
- âŒ `email`
- âŒ `email.*` (æ‰€æœ‰å­æ¨¡å—)
- âŒ `quopri` â† é‡è¦ï¼email.charset ä¾èµ–
- âŒ `uu` â† email ç¼–ç éœ€è¦
- âŒ `base64` â† email.encoders ä¾èµ–
- âŒ `binascii` â† base64 ä¾èµ–
- âŒ `mimetypes` â† requests å¯èƒ½éœ€è¦

### 2. æ›´æ–°åŠŸèƒ½æ¨¡å—

**å¿…é¡»åœ¨ hiddenimports ä¸­**ï¼š
- âœ… `auto_updater`
- âœ… `update_dialog`
- âœ… `version`
- âœ… `requests`
- âœ… `urllib3`
- âœ… `bsdiff4`
- âœ… `certifi`
- âœ… `charset_normalizer`
- âœ… `idna`

### 3. email æ‰€æœ‰å­æ¨¡å—

**å¿…é¡»åœ¨ hiddenimports ä¸­**ï¼š
- âœ… `email.mime`
- âœ… `email.mime.text`
- âœ… `email.mime.multipart`
- âœ… `email.parser`
- âœ… `email.message`
- âœ… `email.utils`
- âœ… `email.encoders`
- âœ… `email.header`
- âœ… `email.charset`
- âœ… `email._policybase`
- âœ… `email._parseaddr`
- âœ… `email._encoded_words`
- âœ… `email._header_value_parser`

---

## ğŸš€ æ£€æŸ¥è„šæœ¬

### 1. éªŒè¯æ‰€æœ‰å¯¼å…¥

```bash
python verify_imports.py
```

åº”è¯¥çœ‹åˆ°æ‰€æœ‰æ¨¡å—éƒ½æ˜¯ âœ…

### 2. æ£€æŸ¥ email ä¾èµ–é“¾

```bash
python check_email_deps.py
```

åº”è¯¥çœ‹åˆ°å®Œæ•´çš„ä¾èµ–æ ‘éƒ½æ˜¯ âœ…

### 3. æ£€æŸ¥ .spec æ–‡ä»¶

æ‰‹åŠ¨æ£€æŸ¥ `XexunRTT_onefile_v2_2.spec`:

**excludes ä¸­ä¸åº”è¯¥æœ‰**ï¼š
```python
excludes=[
    # ... å…¶ä»–æ¨¡å— ...
    # 'email',  # âŒ å·²æ³¨é‡Šï¼Œä¸æ’é™¤
    # 'mimetypes',  # âŒ å·²æ³¨é‡Šï¼Œä¸æ’é™¤
    # 'base64',  # âŒ å·²æ³¨é‡Šï¼Œä¸æ’é™¤
    # 'binascii',  # âŒ å·²æ³¨é‡Šï¼Œä¸æ’é™¤
    # 'quopri',  # âŒ å·²æ³¨é‡Šï¼Œä¸æ’é™¤
    # 'uu',  # âŒ å·²æ³¨é‡Šï¼Œä¸æ’é™¤
]
```

**hiddenimports ä¸­åº”è¯¥æœ‰**ï¼š
```python
hiddenimports=[
    # è‡ªåŠ¨æ›´æ–°ä¾èµ–
    'bsdiff4',
    'requests',
    'urllib3',
    'charset_normalizer',
    'certifi',
    'idna',
    
    # email æ¨¡å—åŠå…¶å­æ¨¡å—
    'email',
    'email.mime',
    'email.mime.text',
    # ... æ›´å¤šå­æ¨¡å—
    
    # è‡ªå®šä¹‰æ¨¡å—
    'auto_updater',
    'update_dialog',
    'version',
]
```

---

## ğŸ“‹ å®Œæ•´æ£€æŸ¥æµç¨‹

### æ­¥éª¤ 1: è¿è¡ŒéªŒè¯è„šæœ¬

```bash
# éªŒè¯æ‰€æœ‰å¯¼å…¥
python verify_imports.py

# æ£€æŸ¥ email ä¾èµ–é“¾
python check_email_deps.py
```

å¦‚æœä»»ä¸€è„šæœ¬å¤±è´¥ï¼Œ**ä¸è¦ç¼–è¯‘**ï¼å…ˆä¿®å¤é—®é¢˜ã€‚

### æ­¥éª¤ 2: æ¸…ç†ç¼“å­˜

```bash
# åˆ é™¤æ—§çš„æ„å»ºæ–‡ä»¶
rmdir /s /q build
rmdir /s /q dist

# æ¸…ç† PyInstaller ç¼“å­˜
rmdir /s /q %LOCALAPPDATA%\pyinstaller
```

### æ­¥éª¤ 3: ç¼–è¯‘

```bash
pyinstaller XexunRTT_onefile_v2_2.spec
```

### æ­¥éª¤ 4: æµ‹è¯•ç¼–è¯‘ç»“æœ

```bash
# æ¸…ç©ºæ—¥å¿—
del %LOCALAPPDATA%\XexunRTT\logs\xexunrtt.log

# è¿è¡Œ EXE
dist\XexunRTT_v2.4.exe
```

### æ­¥éª¤ 5: æ£€æŸ¥æ—¥å¿—

```bash
# æŸ¥çœ‹æ—¥å¿—
type %LOCALAPPDATA%\XexunRTT\logs\xexunrtt.log

# æˆ–ä½¿ç”¨æŸ¥çœ‹å™¨
view_log.bat
```

**å¿…é¡»çœ‹åˆ°**ï¼š
```
âœ… Auto update module loaded successfully
Auto update check scheduled
```

**ä¸åº”è¯¥çœ‹åˆ°**ï¼š
```
âŒ Failed to load auto update module
ModuleNotFoundError: No module named 'xxx'
```

---

## âš ï¸ å¸¸è§é”™è¯¯

### é”™è¯¯ 1: ModuleNotFoundError: No module named 'quopri'

**åŸå› **ï¼š`quopri` è¢«æ’é™¤äº†

**ä¿®å¤**ï¼šåœ¨ `.spec` ä¸­æ³¨é‡Šæ‰ï¼š
```python
# 'quopri',  # âŒ ä¸è¦æ’é™¤ï¼Œemail ä¾èµ–å®ƒ
```

### é”™è¯¯ 2: ModuleNotFoundError: No module named 'email'

**åŸå› **ï¼š`email` è¢«æ’é™¤äº†

**ä¿®å¤**ï¼šåœ¨ `.spec` ä¸­æ³¨é‡Šæ‰ï¼š
```python
# 'email',  # âŒ ä¸è¦æ’é™¤ï¼Œurllib3/requests ä¾èµ–å®ƒ
```

### é”™è¯¯ 3: ModuleNotFoundError: No module named 'base64'

**åŸå› **ï¼š`base64` è¢«æ’é™¤äº†

**ä¿®å¤**ï¼šåœ¨ `.spec` ä¸­æ³¨é‡Šæ‰ï¼š
```python
# 'base64',  # âŒ ä¸è¦æ’é™¤ï¼Œemail.encoders ä¾èµ–å®ƒ
```

### é”™è¯¯ 4: Auto update module not available

**åŸå› **ï¼šæ›´æ–°æ¨¡å—æ²¡æœ‰è¢«æ‰“åŒ…

**ä¿®å¤**ï¼š
1. åœ¨ `main_window.py` ä¸­ç›´æ¥å¯¼å…¥ï¼š
   ```python
   import update_dialog
   import auto_updater
   ```

2. åœ¨ `.spec` çš„ `hiddenimports` ä¸­æ·»åŠ ï¼š
   ```python
   'auto_updater',
   'update_dialog',
   'version',
   ```

---

## ğŸ¯ å¿«é€Ÿæ£€æŸ¥å‘½ä»¤

```bash
# ä¸€é”®è¿è¡Œæ‰€æœ‰æ£€æŸ¥
python verify_imports.py && python check_email_deps.py && echo "All checks passed!"
```

å¦‚æœè¾“å‡ºï¼š
```
All checks passed!
```

è¯´æ˜å¯ä»¥å®‰å…¨ç¼–è¯‘ï¼

---

## ğŸ“ ä¿®æ”¹ .spec æ—¶çš„åŸåˆ™

### âŒ ä¸è¦æ’é™¤çš„æ¨¡å—ç±»å‹

1. **æ ‡å‡†åº“çš„ç¼–ç /è§£ç æ¨¡å—**
   - `base64`, `binascii`, `quopri`, `uu`

2. **æ ‡å‡†åº“çš„ç½‘ç»œ/é‚®ä»¶æ¨¡å—**
   - `email` åŠå…¶æ‰€æœ‰å­æ¨¡å—
   - `mimetypes`
   - `http.client`

3. **ç¬¬ä¸‰æ–¹åº“çš„ä¾èµ–**
   - `requests` â†’ `urllib3` â†’ `email` â†’ `quopri`
   - `PySide6` â†’ `base64` â†’ `binascii`

### âœ… å¯ä»¥å®‰å…¨æ’é™¤çš„æ¨¡å—

1. **ä¸ä½¿ç”¨çš„ GUI æ¡†æ¶**
   - `tkinter`
   - `matplotlib`

2. **æ•°æ®ç§‘å­¦åº“ï¼ˆä¸ä½¿ç”¨æ—¶ï¼‰**
   - `numpy`, `pandas`, `scipy`
   - `tensorflow`, `torch`

3. **å¼€å‘å·¥å…·**
   - `pytest`, `unittest`
   - `pdb`, `profile`, `cProfile`

4. **æ–‡æ¡£å·¥å…·**
   - `sphinx`, `doctest`

---

## ğŸ”§ æ¨èçš„å·¥ä½œæµç¨‹

### ä¿®æ”¹ .spec å

1. âœ… è¿è¡Œ `python verify_imports.py`
2. âœ… è¿è¡Œ `python check_email_deps.py`
3. âœ… æ¸…ç†ç¼“å­˜ `rebuild_clean.bat`
4. âœ… æµ‹è¯• EXE
5. âœ… æŸ¥çœ‹æ—¥å¿—ç¡®è®¤

### æ¯æ¬¡å‘å¸ƒå‰

1. âœ… æ‰€æœ‰æ£€æŸ¥è„šæœ¬é€šè¿‡
2. âœ… EXE æ­£å¸¸å¯åŠ¨
3. âœ… è‡ªåŠ¨æ›´æ–°åŠŸèƒ½å¯ç”¨
4. âœ… æ ¸å¿ƒåŠŸèƒ½æ­£å¸¸

---

## ğŸ“Š æ£€æŸ¥æ¸…å•æ€»ç»“

æ‰“åŒ…å‰ï¼Œç¡®ä¿ï¼š

- [ ] `python verify_imports.py` é€šè¿‡
- [ ] `python check_email_deps.py` é€šè¿‡
- [ ] `.spec` çš„ `excludes` ä¸­ä¸åŒ…å«å¿…éœ€æ¨¡å—
- [ ] `.spec` çš„ `hiddenimports` åŒ…å«æ›´æ–°æ¨¡å—
- [ ] æ¸…ç†äº† build å’Œç¼“å­˜ç›®å½•
- [ ] ç¼–è¯‘æ— é”™è¯¯
- [ ] EXE å¯åŠ¨æ­£å¸¸
- [ ] æ—¥å¿—æ˜¾ç¤º "Auto update module loaded successfully"
- [ ] 5ç§’åæ˜¾ç¤º "Checking for updates from"

**å…¨éƒ¨å®Œæˆåæ‰èƒ½å‘å¸ƒï¼** âœ…

