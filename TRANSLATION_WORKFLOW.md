# ç¿»è¯‘æ–‡ä»¶æ›´æ–°æ ‡å‡†æµç¨‹

## é—®é¢˜è¯´æ˜

æ¯æ¬¡è¿è¡Œ`pyside6-lupdate`éƒ½ä¼šå°†UIç›¸å…³çš„ç¿»è¯‘æ ‡è®°ä¸º`type="unfinished"`ã€‚

**è¿™æ˜¯Qtçš„è®¾è®¡è¡Œä¸ºï¼Œä¸æ˜¯bugï¼**

### ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿ

1. **UIæ–‡ä»¶å˜åŒ–æ£€æµ‹**ï¼šlupdateæ£€æµ‹åˆ°`.ui`æ–‡ä»¶çš„è¡Œå·å˜åŒ–æ—¶ï¼Œä¼šé‡æ–°æ ‡è®°ç¿»è¯‘ä¸ºunfinished
2. **å®‰å…¨æœºåˆ¶**ï¼šQtå‡è®¾UIå˜åŒ–å¯èƒ½å¯¼è‡´ç¿»è¯‘éœ€è¦æ›´æ–°ï¼Œæ ‡è®°unfinishedæé†’æ£€æŸ¥
3. **å®˜æ–¹å·¥ä½œæµ**ï¼šQtæœŸæœ›ä½¿ç”¨Qt Linguistå›¾å½¢å·¥å…·æ¥ç¡®è®¤ç¿»è¯‘

## âœ… æ¨èçš„å·¥ä½œæµç¨‹ï¼ˆè‡ªåŠ¨é”å®šç‰ˆï¼‰

### ğŸ†• æ–¹æ³•1ï¼šä¸€é”®æ›´æ–°ï¼ˆæ¨èï¼‰

ä½¿ç”¨å¢å¼ºç‰ˆè„šæœ¬ï¼Œè‡ªåŠ¨é”å®šUIç¿»è¯‘ï¼š

```bash
python update_translations_locked.py
```

**è¿™ä¸ªè„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆï¼š**
1. âœ… è¿è¡Œ `pyside6-lupdate` æ›´æ–°ç¿»è¯‘
2. âœ… ç§»é™¤æ‰€æœ‰ `type="unfinished"` æ ‡è®°
3. âœ… **é”å®šæ‰€æœ‰UIç¿»è¯‘**ï¼ˆé˜²æ­¢ä¸‹æ¬¡è¢«è¦†ç›–ï¼‰
4. âœ… ç¼–è¯‘ `.qm` æ–‡ä»¶
5. âœ… æ˜¾ç¤ºè¯¦ç»†ç»Ÿè®¡ä¿¡æ¯

**é”å®šåŸç†ï¼š**
- è„šæœ¬ä¼šè¯†åˆ«æ‰€æœ‰æ¥è‡ª`.ui`æ–‡ä»¶çš„ç¿»è¯‘
- ç§»é™¤å®ƒä»¬çš„`type`å±æ€§ï¼ˆæˆ–è®¾ç½®ä¸º`finished`ï¼‰
- ä¸‹æ¬¡è¿è¡Œ`lupdate`æ—¶ï¼ŒQtä¼šä¿ç•™è¿™äº›ç¿»è¯‘çš„çŠ¶æ€

**éªŒè¯é”å®šæ•ˆæœï¼š**
```bash
# å†æ¬¡è¿è¡Œlupdate
pyside6-lupdate main_window.py xexunrtt.ui rtt2uart.py -ts xexunrtt_complete.ts

# æ£€æŸ¥æ˜¯å¦è¿˜æœ‰unfinishedæ ‡è®°
grep 'type="unfinished"' xexunrtt_complete.ts
# åº”è¯¥æ²¡æœ‰ä»»ä½•è¾“å‡ºï¼
```

### æ–¹æ³•2ï¼šæ‰‹åŠ¨æ­¥éª¤ï¼ˆå…¼å®¹æ—§æ–¹æ³•ï¼‰

#### æ­¥éª¤1ï¼šä¿®æ”¹ä»£ç åæ›´æ–°ç¿»è¯‘
```bash
pyside6-lupdate main_window.py xexunrtt.ui rtt2uart.py -ts xexunrtt_complete.ts
```

#### æ­¥éª¤2ï¼šè‡ªåŠ¨ä¿®å¤unfinishedæ ‡è®°
```bash
python smart_fix_translations.py
```

#### æ­¥éª¤3ï¼šæäº¤æ›´æ”¹
```bash
git add xexunrtt_complete.ts xexunrtt_complete.qm
git commit -m "update translations"
```

## ğŸ“‹ ä¸€é”®æ‰¹å¤„ç†è„šæœ¬ï¼ˆWindowsï¼‰

åˆ›å»º`update_translations.bat`ï¼š
```batch
@echo off
echo ========================================
echo ç¿»è¯‘æ–‡ä»¶æ›´æ–°ï¼ˆå¸¦è‡ªåŠ¨é”å®šï¼‰
echo ========================================
echo.
python update_translations_locked.py
echo.
echo å®Œæˆï¼ç¿»è¯‘æ–‡ä»¶å·²æ›´æ–°å¹¶é”å®š
pause
```

æˆ–è€…ç›´æ¥åœ¨å‘½ä»¤è¡Œè¿è¡Œï¼š
```bash
python update_translations_locked.py
```

## ğŸ”§ update_translations_locked.py å·¥ä½œåŸç†

```python
# æ ¸å¿ƒé€»è¾‘ï¼šè‡ªåŠ¨é”å®šUIç¿»è¯‘
def lock_ui_translations():
    for message in context.findall('message'):
        location = message.find('location')
        translation = message.find('translation')
        
        # 1. è¯†åˆ«UIç¿»è¯‘ï¼ˆæ¥è‡ª.uiæ–‡ä»¶ï¼‰
        filename = location.get('filename', '')
        is_from_ui = filename.endswith('.ui')
        
        if is_from_ui and translation.text:
            # 2. ç§»é™¤unfinishedæ ‡è®°ï¼ˆé”å®šç¿»è¯‘ï¼‰
            if translation.get('type') == 'unfinished':
                del translation.attrib['type']
                
            # è¿™æ ·ä¸‹æ¬¡lupdateå°±ä¸ä¼šé‡æ–°æ ‡è®°ä¸ºunfinishedäº†ï¼
```

**ä¸ºä»€ä¹ˆè¿™æ ·èƒ½é”å®šï¼Ÿ**
- Qtçš„`lupdate`åœ¨æ›´æ–°æ—¶ï¼Œä¼šæ£€æŸ¥ç¿»è¯‘çš„`type`å±æ€§
- å¦‚æœæ²¡æœ‰`type`å±æ€§æˆ–`type="finished"`ï¼Œlupdateä¼šä¿ç•™ç°æœ‰ç¿»è¯‘
- åªæœ‰æ˜ç¡®æ ‡è®°ä¸º`unfinished`çš„æ‰ä¼šè¢«é‡æ–°æç¤ºæ£€æŸ¥

## âŒ ä¸æ¨èçš„æ–¹æ³•

### æ–¹æ³•1ï¼šæ‰‹åŠ¨ç¼–è¾‘.tsæ–‡ä»¶
- âŒ å·¥ä½œé‡å¤§
- âŒ å®¹æ˜“é—æ¼
- âŒ å®¹æ˜“å‡ºé”™

### æ–¹æ³•2ï¼šä½¿ç”¨Qt Linguist
- âœ… å®˜æ–¹å·¥å…·ï¼ŒåŠŸèƒ½å¼ºå¤§
- âŒ éœ€è¦å›¾å½¢ç•Œé¢
- âŒ æ¯æ¬¡éƒ½è¦æ‰‹åŠ¨ç‚¹å‡»"å®Œæˆ"æŒ‰é’®
- âŒ ä¸é€‚åˆCI/CD

### æ–¹æ³•3ï¼šä¿®æ”¹lupdateæºç 
- âŒ ä¸ç°å®
- âŒ å‡çº§Qtåä¼šå¤±æ•ˆ

## ğŸ’¡ ä¸ºä»€ä¹ˆQtè¿™æ ·è®¾è®¡ï¼Ÿ

Qtçš„è®¾è®¡å“²å­¦ï¼š
1. **å®‰å…¨ç¬¬ä¸€**ï¼šå®å¯æ ‡è®°è¿‡å¤šï¼Œä¹Ÿä¸æ¼æ‰éœ€è¦æ›´æ–°çš„ç¿»è¯‘
2. **å·¥å…·é“¾å‡è®¾**ï¼šå‡è®¾å¼€å‘è€…ä½¿ç”¨Qt Linguistè¿›è¡Œç¿»è¯‘ç®¡ç†
3. **å¤§å‹é¡¹ç›®ä¼˜åŒ–**ï¼šå¯¹äºæœ‰ä¸“ä¸šç¿»è¯‘å›¢é˜Ÿçš„å¤§é¡¹ç›®ï¼Œè¿™ä¸ªæµç¨‹å¾ˆåˆç†

å¯¹äºæˆ‘ä»¬è¿™ç§å°å‹é¡¹ç›®ï¼Œä½¿ç”¨`smart_fix_translations.py`æ˜¯æœ€ä½³è§£å†³æ–¹æ¡ˆã€‚

## ğŸ¯ æ€»ç»“

| æ–¹æ³• | ä¼˜ç‚¹ | ç¼ºç‚¹ | æ¨èåº¦ |
|------|------|------|--------|
| **update_translations_locked.py** | è‡ªåŠ¨é”å®šã€ä¸€é”®å®Œæˆã€æ°¸ä¹…ç”Ÿæ•ˆ | éœ€è¦Pythonç¯å¢ƒ | â­â­â­â­â­ |
| smart_fix_translations.py | è‡ªåŠ¨åŒ–ã€å¿«é€Ÿ | æ¯æ¬¡éƒ½è¦è¿è¡Œ | â­â­â­â­ |
| Qt Linguist | å®˜æ–¹å·¥å…·ã€å›¾å½¢ç•Œé¢ | æ‰‹åŠ¨æ“ä½œã€æ…¢ | â­â­â­ |
| æ‰‹åŠ¨ç¼–è¾‘ | æ— éœ€å·¥å…· | å®¹æ˜“å‡ºé”™ã€æ…¢ | â­ |

### ğŸ”¥ æœ€ä½³å®è·µ

**ä½¿ç”¨ `update_translations_locked.py`ï¼ˆæ¨èï¼‰ï¼š**
```bash
# ä¿®æ”¹ä»£ç åï¼Œè¿è¡Œä¸€æ¬¡å³å¯
python update_translations_locked.py

# éªŒè¯é”å®šæ•ˆæœï¼ˆå¯é€‰ï¼‰
pyside6-lupdate main_window.py xexunrtt.ui rtt2uart.py -ts xexunrtt_complete.ts
grep 'type="unfinished"' xexunrtt_complete.ts  # åº”è¯¥æ²¡æœ‰è¾“å‡º
```

**ä¼˜åŠ¿ï¼š**
- âœ… **çœŸæ­£è§£å†³é—®é¢˜**ï¼šé”å®šåï¼Œå³ä½¿ç›´æ¥è¿è¡Œ`lupdate`ä¹Ÿä¸ä¼šå‡ºç°unfinished
- âœ… **ä¸€åŠ³æ°¸é€¸**ï¼šé”å®šæ˜¯æŒä¹…çš„ï¼Œä¸éœ€è¦æ¯æ¬¡éƒ½è¿è¡Œè„šæœ¬
- âœ… **è‡ªåŠ¨åŒ–**ï¼šä»æ›´æ–°åˆ°ç¼–è¯‘ä¸€é”®å®Œæˆ
- âœ… **å®‰å…¨**ï¼šåªé”å®šUIç¿»è¯‘ï¼Œä»£ç ç¿»è¯‘ä»å¯æ­£å¸¸æ›´æ–°

