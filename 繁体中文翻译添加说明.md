# 繁体中文翻译添加说明

## ✅ **完成内容**

已成功添加繁体中文（Traditional Chinese）翻译支持！

---

## 📁 **新增文件**

| 文件 | 说明 |
|-----|------|
| `xexunrtt_zh_TW.ts` | 繁体中文翻译源文件（XML格式） |
| `xexunrtt_zh_TW.qm` | 繁体中文翻译编译文件（二进制格式） |
| `convert_to_traditional.py` | 简体转繁体转换脚本 |

---

## 🔄 **转换流程**

### 1. 简繁转换

使用 **OpenCC**（Open Chinese Convert）进行简繁转换：

```bash
pip install opencc-python-reimplemented
python convert_to_traditional.py
```

**转换规则**：
- `s2twp`：Simplified to Traditional (Taiwan standard with phrases)
- 保留英文和代码不变
- 只转换 `<translation>` 和 `<source>` 标签中的中文内容

### 2. 编译翻译文件

```bash
pyside6-lrelease xexunrtt_zh_TW.ts -qm xexunrtt_zh_TW.qm
```

**结果**：
- ✅ 生成了 350 条翻译
- ✅ 其中 332 条包含中文内容

---

## 📊 **翻译统计**

| 项目 | 数量 |
|-----|------|
| 总翻译条目 | 350 |
| 包含中文的翻译 | 332 |
| 完成率 | 100% |

---

## 🎯 **实现细节**

### 修改 `main_window.py`

#### 修改前（简体和繁体共用）

```python
if config_language in ['zh_CN', 'zh_TW']:
    # 简体和繁体都使用同一个文件
    qm_paths = [
        get_resource_path("xexunrtt_complete.qm"),
        "xexunrtt_complete.qm",
    ]
```

#### 修改后（独立翻译文件）

```python
if config_language == 'zh_CN':
    # 简体中文
    qm_paths = [
        get_resource_path("xexunrtt_complete.qm"),
        "xexunrtt_complete.qm",
    ]

elif config_language == 'zh_TW':
    # 繁体中文（独立翻译文件）
    qm_paths = [
        get_resource_path("xexunrtt_zh_TW.qm"),
        "xexunrtt_zh_TW.qm",
    ]
```

---

## 🌍 **语言支持情况**

| 语言 | 代码 | 翻译文件 | 状态 |
|-----|------|---------|------|
| English | `en_US` | （无需翻译） | ✅ 原生支持 |
| 中文（简体） | `zh_CN` | `xexunrtt_complete.qm` | ✅ 已支持 |
| 中文（繁體） | `zh_TW` | `xexunrtt_zh_TW.qm` | ✅ **新增！** |

---

## 🧪 **测试步骤**

### 1. 切换到繁体中文

在程序中：
1. 打开 **Language** 菜单
2. 选择 **中文（繁體）**
3. 点击 OK 并重启程序

或通过命令行：
```bash
python -c "from config_manager import config_manager; config_manager.set_language('zh_TW'); config_manager.save_config()"
```

### 2. 验证翻译

重启程序后，界面应该显示繁体中文：
- 菜单：連接、窗口、工具、Language、幫助
- 按钮：連接、斷開連接、重新連接
- 标签：JLink調試日誌、設備列表

### 3. 测试翻译加载

```bash
python -c "from PySide6.QtCore import QTranslator, QCoreApplication; from PySide6.QtWidgets import QApplication; import sys; app = QApplication(sys.argv); t = QTranslator(); t.load('xexunrtt_zh_TW.qm'); QCoreApplication.installTranslator(t); print(QCoreApplication.translate('main_window', 'JLink Debug Log'))"
```

预期输出：`JLink調試日誌`

---

## 🔧 **转换脚本说明**

### `convert_to_traditional.py`

**功能**：
- 读取简体翻译文件 `xexunrtt_complete.ts`
- 使用 OpenCC 将所有中文翻译转换为繁体
- 保存为 `xexunrtt_zh_TW.ts`
- 更新语言标记为 `zh_TW`

**核心逻辑**：
```python
from opencc import OpenCC

# 创建简体到繁体转换器
cc = OpenCC('s2twp')

# 转换翻译内容
def replace_translation(match):
    translation_text = match.group(2)
    traditional_text = cc.convert(translation_text)
    return f"{opening_tag}{traditional_text}{closing_tag}"

# 正则替换
pattern = r'(<translation[^>]*>)(.*?)(</translation>)'
new_content = re.sub(pattern, replace_translation, content, flags=re.DOTALL)
```

**特性**：
- ✅ 只转换中文内容
- ✅ 保留英文和代码不变
- ✅ 保留 XML 结构
- ✅ 更新语言标记

---

## 📦 **打包注意事项**

### PyInstaller 配置

在 `.spec` 文件中添加繁体翻译文件：

```python
datas=[
    ('xexunrtt_complete.qm', '.'),  # 简体
    ('xexunrtt_zh_TW.qm', '.'),     # 繁体（新增）
    ('qt_zh_CN.qm', '.'),
    # ...
]
```

### macOS 打包

将繁体翻译文件复制到 Resources 目录：

```bash
cp xexunrtt_zh_TW.qm XexunRTT.app/Contents/Resources/
```

---

## 🔄 **更新翻译流程**

当需要更新翻译时：

### 1. 更新简体翻译

```bash
# 提取需要翻译的字符串
pyside6-lupdate *.py *.ui -ts xexunrtt_complete.ts

# 使用 Qt Linguist 翻译
linguist xexunrtt_complete.ts

# 编译简体翻译
pyside6-lrelease xexunrtt_complete.ts -qm xexunrtt_complete.qm
```

### 2. 生成繁体翻译

```bash
# 运行转换脚本
python convert_to_traditional.py

# 编译繁体翻译
pyside6-lrelease xexunrtt_zh_TW.ts -qm xexunrtt_zh_TW.qm
```

### 3. 测试

```bash
# 测试简体
python -c "from config_manager import config_manager; config_manager.set_language('zh_CN'); config_manager.save_config()"
python main_window.py

# 测试繁体
python -c "from config_manager import config_manager; config_manager.set_language('zh_TW'); config_manager.save_config()"
python main_window.py
```

---

## 📝 **简繁对照示例**

| 简体 | 繁体 |
|-----|------|
| 连接 | 連接 |
| 窗口 | 窗口 |
| 工具 | 工具 |
| 帮助 | 幫助 |
| 设备 | 設備 |
| 调试 | 調試 |
| 日志 | 日誌 |
| 配置 | 配置 |
| 断开连接 | 斷開連接 |
| 重新连接 | 重新連接 |
| 清除当前页 | 清除當前頁 |
| 打开日志文件夹 | 打開日誌文件夾 |
| 关于 | 關於 |

---

## 🎨 **界面效果**

### 简体中文（zh_CN）

```
菜单栏
├── 连接(&C)
├── 窗口(&W)
├── 工具(&T)
├── Language
└── 帮助(&H)
```

### 繁体中文（zh_TW）

```
菜單欄
├── 連接(&C)
├── 窗口(&W)
├── 工具(&T)
├── Language
└── 幫助(&H)
```

---

## ⚙️ **依赖项**

### Python 包

```bash
pip install opencc-python-reimplemented  # 简繁转换
```

### 工具

- `pyside6-lupdate`：提取翻译字符串
- `pyside6-lrelease`：编译翻译文件
- `linguist`（可选）：Qt Linguist GUI 工具

---

## 🐛 **已知问题**

### 1. 终端输出乱码

**问题**：Windows 终端显示中文为乱码

```
翻譯測試: 'JLink Debug Log' → 'JLink���e���I'
```

**原因**：Windows 终端默认 GBK 编码，无法正确显示繁体中文

**解决**：
- 实际程序界面显示正常
- 只是终端输出有问题
- 不影响实际使用

### 2. OpenCC 安装

**问题**：某些环境可能无法安装 `opencc-python-reimplemented`

**解决**：
- 使用预生成的 `xexunrtt_zh_TW.ts` 和 `.qm` 文件
- 这些文件已包含在仓库中
- 无需每次都运行转换脚本

---

## ✅ **完成清单**

- [x] 安装 OpenCC 简繁转换工具
- [x] 创建简繁转换脚本 `convert_to_traditional.py`
- [x] 生成繁体翻译文件 `xexunrtt_zh_TW.ts`
- [x] 编译繁体翻译文件 `xexunrtt_zh_TW.qm`
- [x] 修改 `main_window.py` 加载逻辑
- [x] 测试繁体中文显示
- [x] 提交代码到 Git
- [x] 创建文档说明

---

## 🚀 **使用方法**

### 快速切换语言

1. **切换到繁体中文**
   ```bash
   # 方法1：通过 Language 菜单
   Language → 中文（繁體） → OK → 重启

   # 方法2：命令行
   python -c "from config_manager import config_manager; config_manager.set_language('zh_TW'); config_manager.save_config()"
   ```

2. **切换回简体中文**
   ```bash
   python -c "from config_manager import config_manager; config_manager.set_language('zh_CN'); config_manager.save_config()"
   ```

3. **切换到英语**
   ```bash
   python -c "from config_manager import config_manager; config_manager.set_language('en_US'); config_manager.save_config()"
   ```

---

## 📚 **相关文档**

- `语言设置功能说明.md` - 语言设置功能详细说明
- `语言菜单启动问题修复.md` - 启动问题修复
- `convert_to_traditional.py` - 转换脚本源代码

---

## 💡 **技术要点**

### OpenCC 转换标准

- **s2t**：简体到繁体（Simplified to Traditional）
- **s2tw**：简体到台湾正体
- **s2twp**：简体到台湾正体（包含惯用词转换）✅ **使用此标准**
- **s2hk**：简体到香港繁体

选择 `s2twp` 是因为它不仅转换字形，还转换台湾地区的惯用词汇。

### Qt 翻译机制

```python
# 加载翻译文件
translator = QTranslator()
translator.load('xexunrtt_zh_TW.qm')
QCoreApplication.installTranslator(translator)

# 使用翻译
text = QCoreApplication.translate("context", "source_text")
```

---

## 🎉 **总结**

成功添加繁体中文翻译支持！

**现在支持 3 种语言**：
- ✅ English（英语）
- ✅ 中文（简体）
- ✅ 中文（繁體）**← 新增！**

用户可以通过 **Language** 菜单自由切换，满足不同地区用户的需求。

