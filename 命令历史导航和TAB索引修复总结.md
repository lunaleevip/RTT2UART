# å‘½ä»¤å†å²å¯¼èˆªå’ŒTABç´¢å¼•ä¿®å¤æ€»ç»“

## ğŸ” é—®é¢˜æè¿°

ç”¨æˆ·åé¦ˆäº†ä¸¤ä¸ªé‡è¦é—®é¢˜ï¼š
1. **TABç´¢å¼•é”™è¯¯**ï¼šå½“å‰è·å–TAB 1å†…å®¹æ—¶ç´¢å¼•æœ‰è¯¯ï¼Œéœ€è¦+1
2. **å‘½ä»¤å†å²å¯¼èˆªç¼ºå¤±**ï¼šå‘é€æˆåŠŸåéœ€è¦æ¸…ç©ºComboBoxï¼Œå¹¶æ”¯æŒä¸Šä¸‹æ–¹å‘é”®åˆ‡æ¢å†å²å‘½ä»¤

## âœ… ä¿®å¤å†…å®¹

### 1. TABç´¢å¼•ä¿®å¤

#### é—®é¢˜åˆ†æ
- åŸå§‹ä»£ç ä½¿ç”¨ç´¢å¼•1è·å–TAB 1å†…å®¹
- å®é™…TABç»“æ„ï¼šç´¢å¼•0=ALLé¡µé¢ï¼Œç´¢å¼•1=RTT Channel 0ï¼Œç´¢å¼•2=RTT Channel 1
- éœ€è¦ä½¿ç”¨ç´¢å¼•2æ‰èƒ½æ­£ç¡®è·å–RTT Channel 1çš„å†…å®¹

#### ä¿®å¤æ–¹æ¡ˆ
```python
def get_tab1_content(self):
    """è·å–TAB 1 (RTT Channel 1) çš„å½“å‰å†…å®¹"""
    try:
        # TAB 1å¯¹åº”ç´¢å¼•2ï¼ˆç´¢å¼•0æ˜¯ALLé¡µé¢ï¼Œç´¢å¼•1æ˜¯RTT Channel 0ï¼Œç´¢å¼•2æ˜¯RTT Channel 1ï¼‰
        tab_index = 2  # ä¿®å¤ï¼šä»1æ”¹ä¸º2
```

### 2. å‘½ä»¤å†å²å¯¼èˆªåŠŸèƒ½

#### æ–°å¢å±æ€§
åœ¨`RTTMainWindow.__init__()`ä¸­æ·»åŠ ï¼š
```python
# å‘½ä»¤å†å²å¯¼èˆª
self.command_history_index = -1  # å½“å‰å†å²å‘½ä»¤ç´¢å¼•ï¼Œ-1è¡¨ç¤ºæœªé€‰æ‹©å†å²å‘½ä»¤
self.current_input_text = ""     # ä¿å­˜å½“å‰è¾“å…¥çš„æ–‡æœ¬
```

#### äº‹ä»¶è¿‡æ»¤å™¨
ä¸ºComboBoxå®‰è£…äº‹ä»¶è¿‡æ»¤å™¨ï¼š
```python
# ä¸ºComboBoxå®‰è£…äº‹ä»¶è¿‡æ»¤å™¨ä»¥æ”¯æŒä¸Šä¸‹æ–¹å‘é”®å¯¼èˆªå‘½ä»¤å†å²
self.ui.cmd_buffer.installEventFilter(self)
```

#### æ ¸å¿ƒå¯¼èˆªæ–¹æ³•

##### 1. `eventFilter(obj, event)`
```python
def eventFilter(self, obj, event):
    """äº‹ä»¶è¿‡æ»¤å™¨ï¼šå¤„ç†ComboBoxçš„é”®ç›˜äº‹ä»¶"""
    if obj == self.ui.cmd_buffer and event.type() == event.Type.KeyPress:
        key = event.key()
        
        # å¤„ç†ä¸Šæ–¹å‘é”®
        if key == Qt.Key_Up:
            self._navigate_command_history_up()
            return True  # æ¶ˆè´¹äº‹ä»¶
            
        # å¤„ç†ä¸‹æ–¹å‘é”®
        elif key == Qt.Key_Down:
            self._navigate_command_history_down()
            return True  # æ¶ˆè´¹äº‹ä»¶
            
        # å¤„ç†å…¶ä»–æŒ‰é”®æ—¶ä¿å­˜å½“å‰è¾“å…¥
        elif key not in [Qt.Key_Return, Qt.Key_Enter, Qt.Key_Tab]:
            if self.command_history_index == -1:
                QTimer.singleShot(0, self._save_current_input)
    
    return super().eventFilter(obj, event)
```

##### 2. `_navigate_command_history_up()`
```python
def _navigate_command_history_up(self):
    """å‘ä¸Šå¯¼èˆªå‘½ä»¤å†å²"""
    try:
        history_count = self.ui.cmd_buffer.count()
        if history_count == 0:
            return
        
        # å¦‚æœå½“å‰ä¸åœ¨å†å²å¯¼èˆªæ¨¡å¼ï¼Œä¿å­˜å½“å‰è¾“å…¥å¹¶å¼€å§‹å¯¼èˆª
        if self.command_history_index == -1:
            self.current_input_text = self.ui.cmd_buffer.currentText()
            self.command_history_index = 0
        else:
            # å‘ä¸Šç§»åŠ¨ï¼ˆæ›´æ—©çš„å‘½ä»¤ï¼‰
            self.command_history_index = min(self.command_history_index + 1, history_count - 1)
        
        # è®¾ç½®ComboBoxæ˜¾ç¤ºå†å²å‘½ä»¤
        self.ui.cmd_buffer.setCurrentIndex(self.command_history_index)
        # é€‰ä¸­æ–‡æœ¬ï¼Œä¾¿äºç»§ç»­è¾“å…¥æ—¶æ›¿æ¢
        line_edit = self.ui.cmd_buffer.lineEdit()
        if line_edit:
            line_edit.selectAll()
```

##### 3. `_navigate_command_history_down()`
```python
def _navigate_command_history_down(self):
    """å‘ä¸‹å¯¼èˆªå‘½ä»¤å†å²"""
    try:
        if self.command_history_index == -1:
            return
        
        # å‘ä¸‹ç§»åŠ¨ï¼ˆæ›´æ–°çš„å‘½ä»¤ï¼‰
        self.command_history_index -= 1
        
        if self.command_history_index < 0:
            # å›åˆ°å½“å‰è¾“å…¥
            self.command_history_index = -1
            self.ui.cmd_buffer.setCurrentText(self.current_input_text)
        else:
            # è®¾ç½®ComboBoxæ˜¾ç¤ºå†å²å‘½ä»¤
            self.ui.cmd_buffer.setCurrentIndex(self.command_history_index)
        
        # é€‰ä¸­æ–‡æœ¬ï¼Œä¾¿äºç»§ç»­è¾“å…¥æ—¶æ›¿æ¢
        line_edit = self.ui.cmd_buffer.lineEdit()
        if line_edit:
            line_edit.selectAll()
```

##### 4. `_reset_command_history_navigation()`
```python
def _reset_command_history_navigation(self):
    """é‡ç½®å‘½ä»¤å†å²å¯¼èˆªçŠ¶æ€"""
    self.command_history_index = -1
    self.current_input_text = ""
```

### 3. å‘é€æˆåŠŸå¤„ç†ä¼˜åŒ–

åœ¨`on_pushButton_clicked()`çš„å‘é€æˆåŠŸå¤„ç†ä¸­æ·»åŠ ï¼š
```python
# æ£€æŸ¥å‘é€æ˜¯å¦æˆåŠŸ
if(bytes_written == len(out_bytes)):
    # ğŸ”§ ä¿®å¤ï¼šæ­£ç¡®æ¸…ç©ºComboBoxè¾“å…¥æ¡†
    try:
        self.ui.cmd_buffer.clearEditText()
        self.ui.cmd_buffer.setCurrentText("")  # ç¡®ä¿è¾“å…¥æ¡†å®Œå…¨æ¸…ç©º
        logger.debug(f"âœ… Command sent successfully, input cleared: {current_text}")
    except Exception as e:
        logger.error(f"Failed to clear input box: {e}")
    
    # é‡ç½®å‘½ä»¤å†å²å¯¼èˆªçŠ¶æ€
    self._reset_command_history_navigation()
    
    # ... å…¶ä»–å¤„ç†é€»è¾‘ ...
```

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

### 1. æ­£ç¡®çš„TABç´¢å¼•
- âœ… ä½¿ç”¨ç´¢å¼•2æ­£ç¡®è·å–RTT Channel 1å†…å®¹
- âœ… å‡†ç¡®çš„æ³¨é‡Šè¯´æ˜TABç»“æ„
- âœ… ä¿®å¤äº†å†…å®¹æ˜¾ç¤ºé”™è¯¯é—®é¢˜

### 2. æ™ºèƒ½å‘½ä»¤å†å²å¯¼èˆª
- â¬†ï¸ **ä¸Šæ–¹å‘é”®**ï¼šå‘ä¸Šå¯¼èˆªåˆ°æ›´æ—©çš„å†å²å‘½ä»¤
- â¬‡ï¸ **ä¸‹æ–¹å‘é”®**ï¼šå‘ä¸‹å¯¼èˆªåˆ°æ›´æ–°çš„å†å²å‘½ä»¤æˆ–è¿”å›å½“å‰è¾“å…¥
- ğŸ“ **æ™ºèƒ½ä¿å­˜**ï¼šè‡ªåŠ¨ä¿å­˜å½“å‰æ­£åœ¨è¾“å…¥çš„æ–‡æœ¬
- ğŸ”„ **çŠ¶æ€ç®¡ç†**ï¼šå‘é€æˆåŠŸåè‡ªåŠ¨é‡ç½®å¯¼èˆªçŠ¶æ€
- ğŸ¯ **æ–‡æœ¬é€‰ä¸­**ï¼šå¯¼èˆªæ—¶è‡ªåŠ¨é€‰ä¸­æ–‡æœ¬ï¼Œä¾¿äºæ›¿æ¢

### 3. ComboBoxç®¡ç†ä¼˜åŒ–
- ğŸ§¹ **è‡ªåŠ¨æ¸…ç©º**ï¼šå‘é€æˆåŠŸåæ¸…ç©ºè¾“å…¥æ¡†
- ğŸ”„ **çŠ¶æ€é‡ç½®**ï¼šé‡ç½®æ‰€æœ‰å¯¼èˆªç›¸å…³çŠ¶æ€
- ğŸ“‹ **å†å²ä¿æŒ**ï¼šå‘½ä»¤å†å²ä¾ç„¶ä¿å­˜åœ¨ä¸‹æ‹‰åˆ—è¡¨ä¸­

## ğŸ® ç”¨æˆ·ä½“éªŒ

### æ“ä½œæµç¨‹
1. **è¾“å…¥å‘½ä»¤**ï¼šåœ¨ComboBoxä¸­è¾“å…¥æˆ–é€‰æ‹©å‘½ä»¤
2. **ä½¿ç”¨æ–¹å‘é”®**ï¼š
   - æŒ‰â¬†ï¸é”®ï¼šæµè§ˆæ›´æ—©çš„å†å²å‘½ä»¤
   - æŒ‰â¬‡ï¸é”®ï¼šæµè§ˆæ›´æ–°çš„å†å²å‘½ä»¤æˆ–è¿”å›å½“å‰è¾“å…¥
3. **å‘é€å‘½ä»¤**ï¼šç‚¹å‡»SendæŒ‰é’®æˆ–æŒ‰Enter
4. **è‡ªåŠ¨æ¸…ç©º**ï¼šå‘é€æˆåŠŸåè¾“å…¥æ¡†è‡ªåŠ¨æ¸…ç©º
5. **é‡å¤ä½¿ç”¨**ï¼šå¯ä»¥ç»§ç»­ä½¿ç”¨æ–¹å‘é”®æµè§ˆå†å²å‘½ä»¤

### å¯¼èˆªè¡Œä¸º
- **é¦–æ¬¡æŒ‰â¬†ï¸**ï¼šä¿å­˜å½“å‰è¾“å…¥ï¼Œæ˜¾ç¤ºæœ€æ–°çš„å†å²å‘½ä»¤
- **ç»§ç»­æŒ‰â¬†ï¸**ï¼šå‘ä¸Šæµè§ˆæ›´æ—©çš„å‘½ä»¤
- **æŒ‰â¬‡ï¸**ï¼šå‘ä¸‹æµè§ˆæ›´æ–°çš„å‘½ä»¤
- **æŒ‰â¬‡ï¸åˆ°åº•**ï¼šè¿”å›æœ€åˆä¿å­˜çš„å½“å‰è¾“å…¥
- **æ–‡æœ¬é€‰ä¸­**ï¼šæ¯æ¬¡å¯¼èˆªéƒ½ä¼šé€‰ä¸­æ–‡æœ¬ï¼Œä¾¿äºç›´æ¥è¾“å…¥æ›¿æ¢

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯•è¦†ç›–
- âœ… TABç´¢å¼•ä¿®å¤éªŒè¯
- âœ… å‘½ä»¤å†å²å¯¼èˆªå±æ€§æ£€æŸ¥
- âœ… ComboBoxæ¸…ç©ºé›†æˆéªŒè¯
- âœ… å¯¼èˆªåŠŸèƒ½æ¨¡æ‹Ÿæµ‹è¯•
- âœ… äº‹ä»¶è¿‡æ»¤å™¨åŠŸèƒ½æµ‹è¯•

### æµ‹è¯•ç»“æœ
```
ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼

ä¿®å¤å†…å®¹:
1. âœ… TABç´¢å¼•ä¿®å¤ - ä½¿ç”¨æ­£ç¡®çš„ç´¢å¼•2è·å–RTT Channel 1
2. âœ… å‘½ä»¤å†å²å¯¼èˆª - æ”¯æŒä¸Šä¸‹æ–¹å‘é”®åˆ‡æ¢å†å²å‘½ä»¤
3. âœ… ComboBoxæ¸…ç©º - å‘é€æˆåŠŸåæ­£ç¡®æ¸…ç©ºè¾“å…¥æ¡†
4. âœ… å¯¼èˆªçŠ¶æ€é‡ç½® - å‘é€åé‡ç½®å¯¼èˆªçŠ¶æ€
5. âœ… äº‹ä»¶è¿‡æ»¤å™¨ - æ­£ç¡®å¤„ç†é”®ç›˜äº‹ä»¶
```

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### äº‹ä»¶å¤„ç†æœºåˆ¶
- ä½¿ç”¨`installEventFilter()`ä¸ºComboBoxå®‰è£…äº‹ä»¶è¿‡æ»¤å™¨
- åœ¨`eventFilter()`ä¸­å¤„ç†`KeyPress`äº‹ä»¶
- ä¸Šä¸‹æ–¹å‘é”®äº‹ä»¶è¢«æ¶ˆè´¹ï¼ˆè¿”å›Trueï¼‰ï¼Œå…¶ä»–äº‹ä»¶æ­£å¸¸ä¼ é€’ï¼ˆè¿”å›Falseï¼‰

### çŠ¶æ€ç®¡ç†
- `command_history_index`ï¼šè·Ÿè¸ªå½“å‰å†å²å‘½ä»¤ä½ç½®ï¼ˆ-1è¡¨ç¤ºéå¯¼èˆªæ¨¡å¼ï¼‰
- `current_input_text`ï¼šä¿å­˜ç”¨æˆ·æ­£åœ¨è¾“å…¥çš„æ–‡æœ¬
- å‘é€æˆåŠŸåè‡ªåŠ¨é‡ç½®æ‰€æœ‰çŠ¶æ€

### æ–‡æœ¬é€‰ä¸­æœºåˆ¶
- ä½¿ç”¨`lineEdit().selectAll()`é€‰ä¸­ComboBoxä¸­çš„æ–‡æœ¬
- ä¾¿äºç”¨æˆ·ç»§ç»­è¾“å…¥æ—¶ç›´æ¥æ›¿æ¢é€‰ä¸­å†…å®¹

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### äº‹ä»¶å¤„ç†ä¼˜åŒ–
- åªå¤„ç†ComboBoxçš„KeyPressäº‹ä»¶
- ä½¿ç”¨`QTimer.singleShot(0, ...)`å»¶è¿Ÿä¿å­˜å½“å‰è¾“å…¥ï¼Œé¿å…é˜»å¡
- äº‹ä»¶è¿‡æ»¤å™¨é«˜æ•ˆå¤„ç†ï¼Œä¸å½±å“å…¶ä»–ç»„ä»¶

### å†…å­˜ç®¡ç†
- çŠ¶æ€å˜é‡å ç”¨å†…å­˜æå°
- å¯¼èˆªè¿‡ç¨‹ä¸­ä¸åˆ›å»ºé¢å¤–çš„æ•°æ®ç»“æ„
- é‡ç½®æ—¶åŠæ—¶æ¸…ç©ºçŠ¶æ€

## ğŸš€ æœªæ¥æ‰©å±•

### å¯èƒ½çš„å¢å¼ºåŠŸèƒ½
1. **æ¨¡ç³Šæœç´¢**ï¼šæ”¯æŒåœ¨å†å²å‘½ä»¤ä¸­è¿›è¡Œæ¨¡ç³Šæœç´¢
2. **å¿«æ·é”®æ‰©å±•**ï¼šæ”¯æŒCtrl+Up/Downç­‰å¿«æ·é”®
3. **å†å²åˆ†ç»„**ï¼šæŒ‰æ—¶é—´æˆ–ç±»å‹å¯¹å†å²å‘½ä»¤åˆ†ç»„
4. **æ™ºèƒ½æ’åº**ï¼šæ ¹æ®ä½¿ç”¨é¢‘ç‡æ™ºèƒ½æ’åºå†å²å‘½ä»¤
5. **å†å²å¯¼å‡º**ï¼šæ”¯æŒå¯¼å‡ºå‘½ä»¤å†å²åˆ°æ–‡ä»¶

### æ€§èƒ½è¿›ä¸€æ­¥ä¼˜åŒ–
- å¤§é‡å†å²å‘½ä»¤æ—¶çš„è™šæ‹ŸåŒ–æ˜¾ç¤º
- å†å²å‘½ä»¤çš„å¢é‡åŠ è½½
- æ›´æ™ºèƒ½çš„å†…å­˜ç®¡ç†ç­–ç•¥

## ğŸ“‹ ä½¿ç”¨å»ºè®®

### æœ€ä½³å®è·µ
1. **åˆç†ä½¿ç”¨æ–¹å‘é”®**ï¼šç†Ÿæ‚‰ä¸Šä¸‹å¯¼èˆªçš„è¡Œä¸ºæ¨¡å¼
2. **åŠæ—¶å‘é€**ï¼šè¾“å…¥å®ŒæˆååŠæ—¶å‘é€ï¼Œä¿æŒç•Œé¢æ•´æ´
3. **åˆ©ç”¨æ–‡æœ¬é€‰ä¸­**ï¼šå¯¼èˆªåç›´æ¥è¾“å…¥å¯æ›¿æ¢é€‰ä¸­æ–‡æœ¬
4. **è§‚å¯ŸçŠ¶æ€**ï¼šæ³¨æ„ComboBoxçš„æ˜¾ç¤ºçŠ¶æ€åˆ¤æ–­å½“å‰æ¨¡å¼

### æ³¨æ„äº‹é¡¹
- æ–¹å‘é”®å¯¼èˆªä¼šè¦†ç›–ComboBoxçš„é»˜è®¤ä¸‹æ‹‰è¡Œä¸º
- å‘é€æˆåŠŸåçŠ¶æ€ä¼šè‡ªåŠ¨é‡ç½®
- å½“å‰è¾“å…¥ä¼šåœ¨å¯¼èˆªè¿‡ç¨‹ä¸­è¢«ä¿å­˜
- æ–‡æœ¬é€‰ä¸­çŠ¶æ€ä¾¿äºå¿«é€Ÿæ›¿æ¢å†…å®¹

---

*æ­¤æ¬¡ä¿®å¤å¤§å¤§æå‡äº†å‘½ä»¤è¾“å…¥çš„ä¾¿åˆ©æ€§ï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿæ›´é«˜æ•ˆåœ°ä½¿ç”¨å†å²å‘½ä»¤å’Œè¿›è¡Œè®¾å¤‡è°ƒè¯•*
