# XexunRTT v2.1 新功能说明

## 🎯 新增功能概览

### 1. JLINK设备预选功能
解决多个JLINK设备连接时的选择问题

#### 功能特性
- **自动检测设备**：启动时自动扫描所有连接的JLINK设备
- **智能选择对话框**：多设备时弹出选择界面，显示序列号信息
- **偏好记忆**：记住用户偏好的设备序列号，优先显示
- **自动选择**：可配置为自动选择上次使用的设备
- **配置持久化**：设备选择偏好保存到配置文件

#### 使用说明
1. **多设备连接**：当检测到多个JLINK设备时，程序会弹出设备选择对话框
2. **设备显示**：对话框中显示设备信息，包括产品名称和序列号
3. **偏好标记**：偏好的设备会显示⭐标记
4. **记住选择**：勾选"记住此设备作为偏好选择"会将设备加入偏好列表
5. **自动选择**：勾选"下次自动选择上次使用的设备"启用自动选择功能

#### 配置项说明
- `preferred_jlink_serials`：偏好的JLINK序列号列表（最多10个）
- `last_jlink_serial`：上次使用的JLINK序列号
- `auto_select_jlink`：是否自动选择上次使用的设备

### 2. 主窗口极小化功能
支持多设备同时调试的窗口管理

#### 功能特性
- **极小尺寸**：最小窗口尺寸降至 200×150 像素
- **紧凑模式**：快速切换到极简界面，隐藏非必要元素
- **快捷操作**：支持快捷键 Ctrl+M 快速切换
- **右键菜单**：右键快速访问紧凑模式和常用功能
- **多设备友好**：便于同时打开多个窗口监控不同设备

#### 使用说明
1. **菜单操作**：窗口 → 紧凑模式 (Ctrl+M)
2. **快捷键**：按 Ctrl+M 快速切换紧凑模式
3. **右键菜单**：在窗口空白处右键，选择"切换紧凑模式"
4. **手动调整**：直接拖拽窗口边框到最小尺寸

#### 紧凑模式变化
- **隐藏元素**：菜单栏、状态栏、JLink日志区域
- **窗口标题**：添加"- 紧凑模式"标识
- **尺寸调整**：自动调整到 300×200 像素
- **核心保留**：保留RTT日志显示和标签页切换功能

## 🛠️ 技术实现

### JLINK设备检测
```python
# 使用pylink库检测连接的设备
devices = self.jlink.connected_emulators()
for device in devices:
    device_info = {
        'serial': str(device.SerialNumber),
        'product_name': getattr(device, 'acProduct', 'J-Link'),
        'connection': 'USB'
    }
```

### 配置管理增强
```python
# 新增的配置方法
config.add_preferred_jlink_serial(serial)  # 添加偏好设备
config.get_preferred_jlink_serials()       # 获取偏好列表
config.set_auto_select_jlink(True)         # 设置自动选择
```

### 窗口尺寸优化
```python
# 设置极小最小尺寸
self.setMinimumSize(200, 150)

# TAB控件优化
self.ui.tem_switch.setUsesScrollButtons(True)
self.ui.tem_switch.setElideMode(Qt.ElideRight)
```

## 🎯 使用场景

### 多JLINK设备环境
- **开发团队**：每个开发者有独立的JLINK设备
- **多板调试**：同时调试多个开发板
- **自动化测试**：批量设备的自动化测试环境

### 多窗口调试
- **并行监控**：同时监控多个设备的日志输出
- **屏幕空间优化**：在有限的屏幕空间内显示更多窗口
- **快速切换**：在不同设备的调试窗口间快速切换

## 📋 配置示例

### config.ini 新增配置项
```ini
[Connection]
preferred_jlink_serials = ["12345678", "87654321"]
last_jlink_serial = 12345678
auto_select_jlink = true
```

## 🔧 兼容性说明

### 向后兼容
- 原有的设备选择方式保持不变
- 单设备环境无变化，自动使用唯一设备
- 原有配置文件自动升级，不影响现有设置

### 系统要求
- Windows 10/11
- 支持USB连接的JLINK设备
- PySide6 GUI框架

## 🚀 使用建议

### 多设备用户
1. 首次使用时为每个设备设置偏好
2. 启用自动选择功能提高效率
3. 使用紧凑模式节省屏幕空间

### 单设备用户
1. 功能自动退化为原有行为
2. 可选择性启用紧凑模式
3. 配置项可忽略，不影响使用

---

*XexunRTT v2.1 - 让多设备调试更加便捷高效*
