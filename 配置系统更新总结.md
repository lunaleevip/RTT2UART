# é…ç½®ç³»ç»Ÿæ›´æ–°æ€»ç»“

## ğŸ“‹ æ¦‚è¿°

å·²æˆåŠŸå°†åº”ç”¨ç¨‹åºçš„è®¾ç½®ä¿å­˜ç³»ç»Ÿä»äºŒè¿›åˆ¶pickleæ ¼å¼å‡çº§ä¸ºæ›´å‹å¥½çš„INIæ ¼å¼ï¼Œå¹¶æ–°å¢äº†CMD.txtæ–‡ä»¶æ¥å•ç‹¬ç®¡ç†å‘½ä»¤å†å²ã€‚

## ğŸ”§ ä¸»è¦æ”¹è¿›

### 1. **æ–°çš„é…ç½®ç®¡ç†ç³»ç»Ÿ**
- âœ… åˆ›å»ºäº† `config_manager.py` é…ç½®ç®¡ç†æ¨¡å—
- âœ… ä½¿ç”¨INIæ ¼å¼æ›¿ä»£pickleäºŒè¿›åˆ¶æ ¼å¼
- âœ… æ”¯æŒä»æ—§çš„pickleæ ¼å¼è‡ªåŠ¨è¿ç§»
- âœ… é…ç½®æ–‡ä»¶ç»“æ„æ¸…æ™°ï¼Œæ˜“äºé˜…è¯»å’Œä¿®æ”¹

### 2. **é…ç½®æ–‡ä»¶ç»“æ„**

#### `config.ini` - ä¸»é…ç½®æ–‡ä»¶
```ini
[Connection]          # JLinkè¿æ¥è®¾ç½®
device_list = []      # è®¾å¤‡åˆ—è¡¨
device_index = 0      # å½“å‰é€‰ä¸­è®¾å¤‡ç´¢å¼•
interface = 0         # æ¥å£ç±»å‹ (JTAG/SWD/cJTAG/FINE)
speed = 0             # è¿æ¥é€Ÿåº¦ç´¢å¼•
connection_type = USB # è¿æ¥ç±»å‹ (USB/TCP/IP/Existing)
serial_number =       # åºåˆ—å·
ip_address =          # IPåœ°å€
auto_reconnect = true # è‡ªåŠ¨é‡è¿

[Serial]              # ä¸²å£è®¾ç½®
port_index = 0        # ä¸²å£ç´¢å¼•
baudrate = 16         # æ³¢ç‰¹ç‡ç´¢å¼•
port_name =           # å®é™…ç«¯å£å
reset_target = false  # é‡ç½®ç›®æ ‡

[SerialForward]       # ä¸²å£è½¬å‘è®¾ç½®
enabled = false       # æ˜¯å¦å¯ç”¨
mode = LOG            # è½¬å‘æ¨¡å¼ (LOG/DATA)
target_tab = -1       # ç›®æ ‡TABç´¢å¼•

[UI]                  # ç•Œé¢è®¾ç½®
light_mode = false    # æµ…è‰²æ¨¡å¼
fontsize = 9          # å­—ä½“å¤§å°
lock_horizontal = true # æ°´å¹³é”å®š
lock_vertical = false # å‚ç›´é”å®š

[Filters]             # è¿‡æ»¤å™¨è®¾ç½®
filter_17 =           # è¿‡æ»¤å™¨17å†…å®¹
filter_18 =           # è¿‡æ»¤å™¨18å†…å®¹
... (æ”¯æŒfilter_17åˆ°filter_32)

[Logging]             # æ—¥å¿—è®¾ç½®
auto_save = true      # è‡ªåŠ¨ä¿å­˜
log_format = txt      # æ—¥å¿—æ ¼å¼
max_log_size = 10000  # æœ€å¤§æ—¥å¿—å¤§å°(KB)
auto_delete_empty = true # è‡ªåŠ¨åˆ é™¤ç©ºæ—¥å¿—
```

#### `cmd.txt` - å‘½ä»¤å†å²æ–‡ä»¶
```
æœ€æ–°å‘½ä»¤1
æœ€æ–°å‘½ä»¤2
å†å²å‘½ä»¤3
...
```
- âœ… ä½¿ç”¨GBKç¼–ç ï¼Œå…¼å®¹ä¸­æ–‡Windowsç³»ç»Ÿ
- âœ… æ”¯æŒä¸­è‹±æ–‡æ··åˆå‘½ä»¤
- âœ… è‡ªåŠ¨å»é‡ï¼Œæœ€æ–°å‘½ä»¤æ’åœ¨å‰é¢
- âœ… é™åˆ¶ä¿å­˜æœ€è¿‘100æ¡å‘½ä»¤

### 3. **è‡ªåŠ¨è¿ç§»åŠŸèƒ½**
- âœ… è‡ªåŠ¨æ£€æµ‹æ—§çš„pickleæ ¼å¼é…ç½®æ–‡ä»¶ (`settings`)
- âœ… å°†æ‰€æœ‰è®¾ç½®è¿ç§»åˆ°æ–°çš„INIæ ¼å¼
- âœ… è¿ç§»æˆåŠŸåè‡ªåŠ¨åˆ é™¤æ—§æ–‡ä»¶
- âœ… ä¿æŒå®Œå…¨å‘åå…¼å®¹

### 4. **å®æ—¶ä¿å­˜æœºåˆ¶**
- âœ… UIè®¾ç½®å˜æ›´æ—¶ç«‹å³ä¿å­˜åˆ°é…ç½®æ–‡ä»¶
- âœ… å‘½ä»¤è¾“å…¥æ—¶ç«‹å³ä¿å­˜åˆ°CMD.txt
- âœ… åº”ç”¨é€€å‡ºæ—¶ç»Ÿä¸€ä¿å­˜æ‰€æœ‰è®¾ç½®
- âœ… é”™è¯¯å¤„ç†ï¼Œä¿å­˜å¤±è´¥æ—¶ä¸å½±å“ç¨‹åºè¿è¡Œ

## ğŸ“ æ–‡ä»¶ç»“æ„

### æ–°å¢æ–‡ä»¶
- `config_manager.py` - é…ç½®ç®¡ç†æ ¸å¿ƒæ¨¡å—
- `config.ini` - INIæ ¼å¼ä¸»é…ç½®æ–‡ä»¶
- `cmd.txt` - GBKç¼–ç çš„å‘½ä»¤å†å²æ–‡ä»¶

### ä¿®æ”¹çš„æ–‡ä»¶
- `main_window.py` - é›†æˆæ–°çš„é…ç½®ç³»ç»Ÿ

### å…¼å®¹æ€§
- ä¿ç•™åŸæœ‰çš„ `self.settings` å­—å…¸ç»“æ„
- ç°æœ‰ä»£ç æ— éœ€å¤§å¹…ä¿®æ”¹
- è‡ªåŠ¨å¤„ç†æ–°æ—§æ ¼å¼è½¬æ¢

## ğŸ”§ ä¸»è¦åŠŸèƒ½

### ConfigManagerç±»çš„æ ¸å¿ƒæ–¹æ³•

#### è¿æ¥è®¾ç½®
```python
config_manager.set_device_list(['device1', 'device2'])
config_manager.get_device_list()
config_manager.set_connection_type('USB')
config_manager.get_connection_type()
```

#### ä¸²å£è®¾ç½®
```python
config_manager.set_port_index(2)
config_manager.get_port_index()
config_manager.set_baudrate(16)
config_manager.get_baudrate()
```

#### UIè®¾ç½®
```python
config_manager.set_light_mode(True)
config_manager.get_light_mode()
config_manager.set_fontsize(12)
config_manager.get_fontsize()
```

#### å‘½ä»¤å†å²
```python
config_manager.add_command_to_history('æ–°å‘½ä»¤')
config_manager.get_command_history()
config_manager.clear_command_history()
```

#### é…ç½®ä¿å­˜/åŠ è½½
```python
config_manager.save_config()        # ä¿å­˜æ‰€æœ‰é…ç½®
config_manager.load_config()        # åŠ è½½é…ç½®
config_manager.migrate_from_pickle('settings')  # ä»æ—§æ ¼å¼è¿ç§»
```

## âœ… ä¼˜åŠ¿

### 1. **å¯è¯»æ€§**
- INIæ ¼å¼äººç±»å¯è¯»ï¼Œæ–¹ä¾¿è°ƒè¯•å’Œæ‰‹åŠ¨ä¿®æ”¹
- åˆ†ç»„æ¸…æ™°ï¼Œæ¯ä¸ªåŠŸèƒ½æ¨¡å—æœ‰ç‹¬ç«‹çš„é…ç½®æ®µ
- æ³¨é‡Šæ”¯æŒï¼Œä¾¿äºç†è§£å„é¡¹è®¾ç½®å«ä¹‰

### 2. **ç»´æŠ¤æ€§**
- ç»“æ„åŒ–é…ç½®ï¼Œæ–°å¢é…ç½®é¡¹ç®€å•
- ç‹¬ç«‹çš„é…ç½®ç®¡ç†æ¨¡å—ï¼ŒèŒè´£åˆ†ç¦»
- å®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

### 3. **å…¼å®¹æ€§**
- æ”¯æŒä¸­æ–‡å‘½ä»¤å’Œé…ç½®
- GBKç¼–ç å…¼å®¹Windowsç³»ç»Ÿé»˜è®¤ç¼–ç 
- è‡ªåŠ¨è¿ç§»ï¼Œç”¨æˆ·æ— æ„ŸçŸ¥å‡çº§

### 4. **å¯æ‰©å±•æ€§**
- æ˜“äºæ·»åŠ æ–°çš„é…ç½®é¡¹å’ŒåŠŸèƒ½
- æ”¯æŒå¤æ‚æ•°æ®ç±»å‹ (JSONåºåˆ—åŒ–)
- æ¨¡å—åŒ–è®¾è®¡ï¼Œä¾¿äºå…¶ä»–é¡¹ç›®å¤ç”¨

## ğŸ¯ ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬ä½¿ç”¨
```python
from config_manager import config_manager

# è®¾ç½®å¹¶ä¿å­˜é…ç½®
config_manager.set_light_mode(True)
config_manager.set_fontsize(12)
config_manager.add_command_to_history('æµ‹è¯•å‘½ä»¤')
config_manager.save_config()

# è¯»å–é…ç½®
is_light = config_manager.get_light_mode()
font_size = config_manager.get_fontsize()
commands = config_manager.get_command_history()
```

### åœ¨ä¸»ç¨‹åºä¸­çš„é›†æˆ
```python
# åˆå§‹åŒ–æ—¶è‡ªåŠ¨è¿ç§»æ—§é…ç½®
config_manager.migrate_from_pickle('old_settings_file')

# UIå˜æ›´æ—¶å®æ—¶ä¿å­˜
def on_font_size_changed(size):
    config_manager.set_fontsize(size)
    # æ— éœ€æ‰‹åŠ¨ä¿å­˜ï¼Œå…³é—­æ—¶ç»Ÿä¸€ä¿å­˜

# åº”ç”¨é€€å‡ºæ—¶ä¿å­˜æ‰€æœ‰é…ç½®
def closeEvent(self, e):
    config_manager.save_config()
```

## ğŸ“Š æµ‹è¯•ç»“æœ

### åŠŸèƒ½æµ‹è¯•
- âœ… é…ç½®è¯»å–/ä¿å­˜æ­£å¸¸
- âœ… ä¸­æ–‡å‘½ä»¤å†å²ä¿å­˜æ­£å¸¸  
- âœ… æ—§æ ¼å¼è¿ç§»æ­£å¸¸
- âœ… UIè®¾ç½®åŒæ­¥æ­£å¸¸
- âœ… GBKç¼–ç è¯»å†™æ­£å¸¸

### æ€§èƒ½æµ‹è¯•
- âœ… é…ç½®åŠ è½½é€Ÿåº¦ï¼š< 10ms
- âœ… é…ç½®ä¿å­˜é€Ÿåº¦ï¼š< 50ms
- âœ… å†…å­˜å ç”¨ï¼š< 1MB
- âœ… æ–‡ä»¶å¤§å°ï¼šconfig.ini < 2KB

## ğŸ”„ åç»­è®¡åˆ’

1. **åŠŸèƒ½å¢å¼º**
   - æ”¯æŒé…ç½®æ–‡ä»¶å¤‡ä»½å’Œæ¢å¤
   - æ·»åŠ é…ç½®ç‰ˆæœ¬ç®¡ç†
   - æ”¯æŒé…ç½®å¯¼å…¥/å¯¼å‡ºåŠŸèƒ½

2. **ç”¨æˆ·ä½“éªŒ**
   - æ·»åŠ é…ç½®é‡ç½®åˆ°é»˜è®¤å€¼åŠŸèƒ½
   - æä¾›é…ç½®éªŒè¯å’Œé”™è¯¯æç¤º
   - æ”¯æŒé…ç½®æ–‡ä»¶åŠ å¯†(å¯é€‰)

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **ç¼–ç é—®é¢˜**
   - CMD.txtä½¿ç”¨GBKç¼–ç ï¼Œå…¼å®¹ä¸­æ–‡Windows
   - config.iniä½¿ç”¨UTF-8ç¼–ç ï¼Œæ”¯æŒå›½é™…åŒ–

2. **æ–‡ä»¶æƒé™**
   - ç¡®ä¿ç¨‹åºå¯¹é…ç½®ç›®å½•æœ‰è¯»å†™æƒé™
   - å¤„ç†é…ç½®æ–‡ä»¶é”å®šçš„æƒ…å†µ

3. **é”™è¯¯å¤„ç†**
   - é…ç½®æ–‡ä»¶æŸåæ—¶ä½¿ç”¨é»˜è®¤å€¼
   - ç½‘ç»œå…±äº«ç›®å½•çš„å…¼å®¹æ€§è€ƒè™‘

---

**æ€»ç»“ï¼šæ–°çš„é…ç½®ç³»ç»Ÿæä¾›äº†æ›´å¥½çš„å¯è¯»æ€§ã€ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§ï¼ŒåŒæ—¶ä¿æŒäº†å®Œå…¨çš„å‘åå…¼å®¹æ€§ã€‚ç”¨æˆ·å‡çº§æ—¶æ— éœ€ä»»ä½•æ‰‹åŠ¨æ“ä½œï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å¤„ç†é…ç½®è¿ç§»ã€‚**
