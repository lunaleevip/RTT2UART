# è¯­è¨€èœå•å¯åŠ¨é—®é¢˜ä¿®å¤

## ğŸ› **é—®é¢˜æè¿°**

ç¨‹åºæ— æ³•å¯åŠ¨ï¼ŒæŠ¥é”™ï¼š

```python
Traceback (most recent call last):
  File "e:\coder\RTT2UART2\main_window.py", line 8098, in <module>
    main_window = RTTMainWindow()
  File "e:\coder\RTT2UART2\main_window.py", line 1054, in __init__
    self._create_menu_bar()
  File "e:\coder\RTT2UART2\main_window.py", line 1500, in _create_menu_bar
    current_language = self.connection_dialog.config.get_language()
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'config'
```

---

## ğŸ” **æ ¹æœ¬åŸå› **

### åˆå§‹åŒ–é¡ºåºé—®é¢˜

```python
class RTTMainWindow(QMainWindow):
    def __init__(self):
        super(RTTMainWindow, self).__init__()
        
        self.connection_dialog = None  # â† ç¬¬ 1012 è¡Œï¼šåˆå§‹åŒ–ä¸º None
        
        # ... å…¶ä»–åˆå§‹åŒ– ...
        
        self._create_menu_bar()  # â† ç¬¬ 1054 è¡Œï¼šåˆ›å»ºèœå•æ 
        
        # ... æ›´å¤šåˆå§‹åŒ– ...
        
        self.connection_dialog = ConnectionDialog(self)  # â† ç¬¬ 1071 è¡Œï¼šåˆ›å»ºå¯¹è¯æ¡†
```

**é—®é¢˜**ï¼š
- `_create_menu_bar()` åœ¨ç¬¬ 1054 è¡Œè¢«è°ƒç”¨
- ä½† `connection_dialog` ç›´åˆ°ç¬¬ 1071 è¡Œæ‰è¢«åˆ›å»º
- åœ¨ `_create_menu_bar()` ä¸­è®¿é—® `self.connection_dialog.config` æ—¶ï¼Œ`connection_dialog` è¿˜æ˜¯ `None`

### é”™è¯¯ä»£ç 

```python
def _create_menu_bar(self):
    # Language èœå•
    self.language_menu = menubar.addMenu("Language")
    
    # âŒ é”™è¯¯ï¼šæ­¤æ—¶ connection_dialog è¿˜æœªåˆ›å»º
    current_language = self.connection_dialog.config.get_language()
```

---

## âœ… **ä¿®å¤æ–¹æ¡ˆ**

### ä½¿ç”¨å…¨å±€ config_manager

ç”±äº `config_manager` æ˜¯å…¨å±€å•ä¾‹å¯¹è±¡ï¼Œåœ¨ç¨‹åºå¯åŠ¨æ—¶å°±å·²ç»åŠ è½½ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚

### ä¿®å¤ä»£ç 

```python
def _create_menu_bar(self):
    # Language èœå•
    self.language_menu = menubar.addMenu("Language")
    
    # âœ… æ­£ç¡®ï¼šä½¿ç”¨å…¨å±€ config_manager
    current_language = config_manager.get_language()
```

åŒæ ·ï¼Œåœ¨ `_change_language()` æ–¹æ³•ä¸­ä¹Ÿéœ€è¦ä¿®æ”¹ï¼š

```python
def _change_language(self, language: str):
    # âœ… æ­£ç¡®ï¼šä½¿ç”¨å…¨å±€ config_manager
    config_manager.set_language(language)
    config_manager.save_config()
```

---

## ğŸ“Š **ä¿®å¤å‰åå¯¹æ¯”**

### ä¿®å¤å‰

| ä»£ç  | é—®é¢˜ |
|-----|------|
| `self.connection_dialog.config.get_language()` | âŒ `connection_dialog` ä¸º `None` |
| `self.connection_dialog.config.set_language()` | âŒ `connection_dialog` ä¸º `None` |
| `self.connection_dialog.config.save_config()` | âŒ `connection_dialog` ä¸º `None` |

### ä¿®å¤å

| ä»£ç  | çŠ¶æ€ |
|-----|------|
| `config_manager.get_language()` | âœ… å…¨å±€å¯¹è±¡ï¼Œå§‹ç»ˆå¯ç”¨ |
| `config_manager.set_language()` | âœ… å…¨å±€å¯¹è±¡ï¼Œå§‹ç»ˆå¯ç”¨ |
| `config_manager.save_config()` | âœ… å…¨å±€å¯¹è±¡ï¼Œå§‹ç»ˆå¯ç”¨ |

---

## ğŸ¯ **ä¸ºä»€ä¹ˆä½¿ç”¨å…¨å±€ config_managerï¼Ÿ**

### 1. å•ä¾‹æ¨¡å¼

`config_manager` æ˜¯åœ¨æ¨¡å—çº§åˆ«åˆ›å»ºçš„å…¨å±€å•ä¾‹ï¼š

```python
# config_manager.py
class ConfigManager:
    # ... é…ç½®ç®¡ç†é€»è¾‘ ...

# åˆ›å»ºå…¨å±€å•ä¾‹
config_manager = ConfigManager()
```

### 2. ç¨‹åºå¯åŠ¨æ—¶åŠ è½½

```python
# main_window.py
from config_manager import config_manager  # â† å¯¼å…¥å…¨å±€å®ä¾‹

# ... ç¨‹åºå¯åŠ¨ ...
config_manager.load_config()  # â† åŠ è½½é…ç½®
```

### 3. æ•´ä¸ªç¨‹åºå…±äº«

æ‰€æœ‰æ¨¡å—éƒ½å¯ä»¥å¯¼å…¥å¹¶ä½¿ç”¨åŒä¸€ä¸ª `config_manager` å®ä¾‹ï¼š

```python
from config_manager import config_manager

# ä»»ä½•åœ°æ–¹éƒ½å¯ä»¥ä½¿ç”¨
language = config_manager.get_language()
```

---

## ğŸ”§ **å…¶ä»–å¯èƒ½çš„è§£å†³æ–¹æ¡ˆ**

### æ–¹æ¡ˆ 1ï¼šå»¶è¿Ÿåˆ›å»ºèœå•ï¼ˆä¸æ¨èï¼‰

```python
def __init__(self):
    super().__init__()
    
    self.connection_dialog = ConnectionDialog(self)  # å…ˆåˆ›å»º
    self._create_menu_bar()  # ååˆ›å»ºèœå•
```

**ç¼ºç‚¹**ï¼š
- æ”¹å˜åˆå§‹åŒ–é¡ºåºå¯èƒ½å½±å“å…¶ä»–åŠŸèƒ½
- èœå•æ åº”è¯¥åœ¨çª—å£åˆå§‹åŒ–æ—¶å°±åˆ›å»º

### æ–¹æ¡ˆ 2ï¼šä½¿ç”¨å…¨å±€ config_managerï¼ˆæ¨è âœ…ï¼‰

```python
def _create_menu_bar(self):
    # ç›´æ¥ä½¿ç”¨å…¨å±€ config_manager
    current_language = config_manager.get_language()
```

**ä¼˜ç‚¹**ï¼š
- âœ… ä¸æ”¹å˜åˆå§‹åŒ–é¡ºåº
- âœ… ä»£ç æ›´ç®€æ´
- âœ… é€»è¾‘æ›´æ¸…æ™°
- âœ… ç¬¦åˆå•ä¾‹æ¨¡å¼

---

## ğŸ§ª **éªŒè¯ä¿®å¤**

### æµ‹è¯•æ­¥éª¤

1. **å¯åŠ¨ç¨‹åº**
   ```bash
   python main_window.py
   ```

2. **æ£€æŸ¥èœå•æ **
   - åº”è¯¥èƒ½çœ‹åˆ° `Language` èœå•
   - ä¸åº”è¯¥æœ‰ `AttributeError`

3. **æµ‹è¯•è¯­è¨€åˆ‡æ¢**
   - æ‰“å¼€ `Language` èœå•
   - ç‚¹å‡»ä¸åŒè¯­è¨€é€‰é¡¹
   - åº”è¯¥èƒ½æ­£å¸¸ä¿å­˜å’Œé‡å¯

### é¢„æœŸç»“æœ

```
âœ… ç¨‹åºæ­£å¸¸å¯åŠ¨
âœ… Language èœå•æ­£å¸¸æ˜¾ç¤º
âœ… å½“å‰è¯­è¨€æ­£ç¡®å‹¾é€‰
âœ… è¯­è¨€åˆ‡æ¢åŠŸèƒ½æ­£å¸¸
```

---

## ğŸ“ **æ¶‰åŠçš„æ–‡ä»¶**

| æ–‡ä»¶ | ä¿®æ”¹ |
|-----|------|
| `main_window.py` | ä¿®å¤ `_create_menu_bar()` å’Œ `_change_language()` ä¸­çš„é…ç½®è®¿é—® |

### å…·ä½“ä¿®æ”¹

```diff
def _create_menu_bar(self):
    # Language èœå•
    self.language_menu = menubar.addMenu("Language")
    
-   current_language = self.connection_dialog.config.get_language()
+   current_language = config_manager.get_language()

def _change_language(self, language: str):
-   self.connection_dialog.config.set_language(language)
-   self.connection_dialog.config.save_config()
+   config_manager.set_language(language)
+   config_manager.save_config()
```

---

## ğŸ’¡ **ç»éªŒæ•™è®­**

### 1. æ³¨æ„åˆå§‹åŒ–é¡ºåº

åœ¨ `__init__` æ–¹æ³•ä¸­ï¼š
- âœ… å…ˆåˆå§‹åŒ–æ‰€æœ‰æˆå‘˜å˜é‡
- âœ… å†è°ƒç”¨éœ€è¦è¿™äº›å˜é‡çš„æ–¹æ³•
- âš ï¸ é¿å…è¿‡æ—©è®¿é—®æœªåˆå§‹åŒ–çš„å¯¹è±¡

### 2. ä¼˜å…ˆä½¿ç”¨å…¨å±€å•ä¾‹

å¯¹äºé…ç½®ç®¡ç†è¿™ç±»å…¨å±€çŠ¶æ€ï¼š
- âœ… ä½¿ç”¨å…¨å±€å•ä¾‹ `config_manager`
- âœ… é¿å…é€šè¿‡å¤šå±‚å¯¹è±¡è®¿é—® `self.dialog.config`
- âœ… ä»£ç æ›´ç®€æ´ï¼Œä¾èµ–æ›´æ¸…æ™°

### 3. æµ‹è¯•å¯åŠ¨æµç¨‹

æ·»åŠ æ–°åŠŸèƒ½åï¼š
- âœ… ç«‹å³æµ‹è¯•ç¨‹åºæ˜¯å¦èƒ½å¯åŠ¨
- âœ… æ£€æŸ¥æ‰€æœ‰åˆå§‹åŒ–è·¯å¾„
- âœ… ç¡®ä¿æ²¡æœ‰ `NoneType` è®¿é—®é”™è¯¯

---

## âœ… **ä¿®å¤çŠ¶æ€**

- [x] è¯†åˆ«é—®é¢˜ï¼ˆ`AttributeError: 'NoneType' object has no attribute 'config'`ï¼‰
- [x] åˆ†ææ ¹æœ¬åŸå› ï¼ˆåˆå§‹åŒ–é¡ºåºé—®é¢˜ï¼‰
- [x] å®æ–½ä¿®å¤ï¼ˆä½¿ç”¨å…¨å±€ `config_manager`ï¼‰
- [x] æµ‹è¯•éªŒè¯ï¼ˆç¨‹åºæ­£å¸¸å¯åŠ¨ï¼‰
- [x] æäº¤ä»£ç 
- [x] åˆ›å»ºæ–‡æ¡£

**çŠ¶æ€**ï¼šâœ… å·²å®Œå…¨ä¿®å¤

---

## ğŸš€ **ç°åœ¨å¯ä»¥ä½¿ç”¨**

ç¨‹åºå·²ç»å¯ä»¥æ­£å¸¸å¯åŠ¨ï¼ŒLanguage èœå•åŠŸèƒ½å®Œå…¨å¯ç”¨ï¼š

```bash
# è¿è¡Œç¨‹åº
python main_window.py

# æˆ–è¿è¡Œç¼–è¯‘åçš„ç¨‹åº
dist\XexunRTT_v2.4.exe
```

**èœå•ä½ç½®**ï¼š
```
èœå•æ  â†’ Language â†’ English / ä¸­æ–‡ï¼ˆç®€ä½“ï¼‰ / ä¸­æ–‡ï¼ˆç¹é«”ï¼‰
```

åŠŸèƒ½æ­£å¸¸ï¼ğŸ‰

